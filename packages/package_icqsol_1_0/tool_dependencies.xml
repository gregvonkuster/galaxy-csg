<?xml version="1.0"?>
<tool_dependency>
    <package name="cmake" version="3.2.3">
        <repository name="package_cmake_3_2_3" owner="iuc" prior_installation_required="True" />
    </package>
    <package name="icqsol" version="1.0">
        <install version="1.0">
            <actions_group>
                <actions os="linux" architecture="x86_64">
                    <!-- Install and compile Anaconda 2.3.0 which provides Python 2.7.10 -->
                    <action type="download_file" target_filename="Anaconda-2.3.0-Linux-x86_64.sh">https://3230d63b5fc54e62148e-c95ac804525aac4b6dba79b00b39d1d3.ssl.cf1.rackcdn.com/Anaconda-2.3.0-Linux-x86_64.sh</action>

                    <action type="set_environment_for_install">
                        <repository name="package_cmake_3_2_3" owner="iuc">
                            <package name="cmake" version="3.2.3" />
                        </repository>
                    </action>

                    <action type="shell_command">bash Anaconda-2.3.0-Linux-x86_64.sh -b -f -p $INSTALL_DIR</action>

                    <!-- Install VTK 6.2.0 into the above Python -->
                    <action type="make_directory">$TMP_WORK_DIR/vtk</action>
                    <action type="change_directory">$TMP_WORK_DIR/vtk</action>
                    <action type="download_file" target_filename="VTK-6.3.0.tar.gz">http://www.vtk.org/files/release/6.3/VTK-6.3.0.tar.gz</action>
                    <action type="shell_command">tar xfvz VTK-6.3.0.tar.gz</action>
                    <action type="change_directory">VTK-6.3.0</action>
                    <action type="shell_command">
                        <![CDATA[
                            export PATH=$INSTALL_DIR/bin:$PATH &&
                            export PYTHONPATH=$INSTALL_DIR:$PYTHONPATH &&
                            export PKG_CONFIG_PATH=$INSTALL_DIR/lib/pkgconfig:$PKG_CONFIG_PATH &&
                            cmake \
                            -DCMAKE_BUILD_TYPE:STRING=Release \
                            -DCMAKE_INSTALL_PREFIX:PATH=$INSTALL_DIR/vtk \
                            -DVTK_WRAP_PYTHON:BOOL=ON \
                            -DVTK_Group_StandAlone:BOOL=OFF \
                            -DVTK_Group_Rendering:BOOL=OFF \
                            -DModule_vtkCommonColor:BOOL=ON \
                            -DModule_vtkCommonComputationalGeometry:BOOL=ON \
                            -DModule_vtkCommonDataModel:BOOL=ON \
                            -DModule_vtkCommonExecutionModel:BOOL=ON \
                            -DModule_vtkCommonMath:BOOL=ON \
                            -DModule_vtkCommonMisc:BOOL=ON \
                            -DModule_vtkCommonSystem:BOOL=ON \
                            -DModule_vtkCommonTransforms:BOOL=ON \
                            -DModule_vtkFiltersCore:BOOL=ON \
                            -DModule_vtkFiltersExtraction:BOOL=ON \
                            -DModule_vtkFiltersGeneral:BOOL=ON \
                            -DModule_vtkFiltersGeneric:BOOL=ON \
                            -DModule_vtkFiltersGeometry:BOOL=ON \
                            -DModule_vtkFiltersPython:BOOL=ON \
                            -DModule_vtkImagingHybrid:BOOL=ON \
                            -DModule_vtkIOCore:BOOL=ON \
                            -DModule_vtkIOGeometry:BOOL=ON \
                            -DModule_vtkIOLegacy:BOOL=ON \
                            -DModule_vtkWrappingPythonCore:BOOL=ON \
                            -DModule_vtkIOPLY:BOOL=ON \
                            -DVTK_INSTALL_PYTHON_MODULE_DIR:PATH=$INSTALL_DIR/lib/python2.7/site-packages \
                            -DPYTHON_EXECUTABLE:PATH=$INSTALL_DIR/bin/python \
                            -DPYTHON_LIBRARY:PATH=$INSTALL_DIR/lib/libpython2.7.so \
                            -DPYTHON_INCLUDE_DIR:PATH=$INSTALL_DIR/include/python2.7 . &&
                            make &&
                            make install
                        ]]>
                    </action>
                     <action type="move_directory_files">
                         <source_directory>../build/bin</source_directory>
                         <destination_directory>$INSTALL_DIR/bin</destination_directory>
                     </action>
                     <action type="move_directory_files">
                         <source_directory>../build/include</source_directory>
                         <destination_directory>$INSTALL_DIR/include</destination_directory>
                     </action>
                     <action type="move_directory_files">
                         <source_directory>../build/lib</source_directory>
                         <destination_directory>$INSTALL_DIR/lib</destination_directory>
                     </action>

                    <!-- Install and compile icqsol version 1.0 as a package in the above Python -->
                    <action type="make_directory">$TMP_WORK_DIR/icqsol</action>
                    <action type="change_directory">$TMP_WORK_DIR/icqsol</action>
                    <action type="shell_command">git clone https://github.com/pletzer/icqsol.git</action>
                    <action type="change_directory">icqsol</action>
                    <action type="shell_command">
                        <![CDATA[
                            export PATH=$INSTALL_DIR/bin:$PATH && 
                            export VTK_INCLUDE_DIR=$INSTALL_DIR/vtk/include/vtk-6.3 &&
                            export VTK_LIBRARY_DIR=$INSTALL_DIR/vtk/lib &&
                            $INSTALL_DIR/bin/python setup.py develop --prefix=$INSTALL_DIR
                            $INSTALL_DIR/bin/python setup.py install --prefix=$INSTALL_DIR
                        ]]>
                    </action>

                    <action type="set_environment">
                        <!--
                        Only the PATH environment variable needs to be modified for an Anaconda environment so that it gets
                        the right Python from the environment bin directory.
                        -->
                        <environment_variable action="prepend_to" name="PATH">$INSTALL_DIR/bin</environment_variable>
                        <environment_variable action="prepend_to" name="LD_LIBRARY_PATH">$INSTALL_DIR/lib</environment_variable>
                        <environment_variable action="set_to" name="ICQSOL_ROOT_DIR">$INSTALL_DIR</environment_variable>
                    </action>
                </actions>

                <actions os="darwin" architecture="x86_64">
                    <!-- Install and compile Anaconda 2.3.0 which provides Python 2.7.10 -->
                    <action type="download_file" target_filename="Anaconda-2.3.0-MacOSX-x86_64.sh">https://3230d63b5fc54e62148e-c95ac804525aac4b6dba79b00b39d1d3.ssl.cf1.rackcdn.com/Anaconda-2.3.0-MacOSX-x86_64.sh</action>

                    <action type="set_environment_for_install">
                        <repository name="package_cmake_3_2_3" owner="iuc">
                            <package name="cmake" version="3.2.3" />
                        </repository>
                    </action>

                    <action type="shell_command">bash Anaconda-2.3.0-MacOSX-x86_64.sh -b -f -p $INSTALL_DIR</action>

                    <!-- Install and compile VTK 6.2.0 as a package in the above Python -->
                    <action type="make_directory">$TMP_WORK_DIR/vtk</action>
                    <action type="change_directory">$TMP_WORK_DIR/vtk</action>
                    <action type="download_file" target_filename="VTK-6.2.0.tar.gz">http://www.vtk.org/files/release/6.2/VTK-6.2.0.tar.gz</action>
                    <action type="shell_command">tar xfvz VTK-6.2.0.tar.gz</action>
                    <action type="change_directory">VTK-6.2.0</action>
                    <action type="shell_command">
                        <![CDATA[
                            export PATH=$INSTALL_DIR/bin:$INSTALL_DIR/bin:$PATH &&
                            export PKG_CONFIG_PATH=$INSTALL_DIR/lib/pkgconfig:$PKG_CONFIG_PATH &&
                            cmake \
                            -DCMAKE_BUILD_TYPE:STRING=Release \
                            -DCMAKE_INSTALL_PREFIX:PATH=`pwd`/../build \
                            -DVTK_WRAP_PYTHON:BOOL=ON \
                            -DVTK_Group_StandAlone:BOOL=OFF \
                            -DVTK_Group_Rendering:BOOL=OFF \
                            -DModule_vtkCommonColor:BOOL=ON \
                            -DModule_vtkCommonComputationalGeometry:BOOL=ON \
                            -DModule_vtkCommonDataModel:BOOL=ON \
                            -DModule_vtkCommonExecutionModel:BOOL=ON \
                            -DModule_vtkCommonMath:BOOL=ON \
                            -DModule_vtkCommonMisc:BOOL=ON \
                            -DModule_vtkCommonSystem:BOOL=ON \
                            -DModule_vtkCommonTransforms:BOOL=ON \
                            -DModule_vtkFiltersCore:BOOL=ON \
                            -DModule_vtkFiltersExtraction:BOOL=ON \
                            -DModule_vtkFiltersGeneral:BOOL=ON \
                            -DModule_vtkFiltersGeneric:BOOL=ON \
                            -DModule_vtkFiltersGeometry:BOOL=ON \
                            -DModule_vtkFiltersPython:BOOL=ON \
                            -DModule_vtkImagingHybrid:BOOL=ON \
                            -DModule_vtkIOCore:BOOL=ON \
                            -DModule_vtkIOGeometry:BOOL=ON \
                            -DModule_vtkIOLegacy:BOOL=ON \
                            -DModule_vtkWrappingPythonCore:BOOL=ON \
                            -DModule_vtkIOPLY:BOOL=ON \
                            -DVTK_INSTALL_PYTHON_MODULE_DIR:PATH=$INSTALL_DIR/lib/python2.7/site-packages \
                            -DPYTHON_EXECUTABLE:PATH=$INSTALL_DIR/bin/python \
                            -DPYTHON_LIBRARY:PATH=$INSTALL_DIR/lib/libpython2.7.dylib \
                            -DPYTHON_INCLUDE_DIR:PATH=$INSTALL_DIR/include/python2.7 . &&
                            make &&
                            make install
                        ]]>
                    </action>
                     <action type="move_directory_files">
                         <source_directory>../build/bin</source_directory>
                         <destination_directory>$INSTALL_DIR/bin</destination_directory>
                     </action>
                     <action type="move_directory_files">
                         <source_directory>../build/include</source_directory>
                         <destination_directory>$INSTALL_DIR/include</destination_directory>
                     </action>
                     <action type="move_directory_files">
                         <source_directory>../build/lib</source_directory>
                         <destination_directory>$INSTALL_DIR/lib</destination_directory>
                     </action>

                    <!-- Install and compile icqsol version 1.0 as a package in the above Python -->
                    <action type="make_directory">$TMP_WORK_DIR/icqsol</action>
                    <action type="change_directory">$TMP_WORK_DIR/icqsol</action>
                    <action type="shell_command">git clone https://github.com/pletzer/icqsol.git</action>
                    <action type="change_directory">icqsol</action>
                    <action type="shell_command">
                        <![CDATA[
                            export PATH=$INSTALL_DIR/bin:$PATH &&
                            $INSTALL_DIR/bin/python setup.py develop --prefix=$INSTALL_DIR &&
                            $INSTALL_DIR/bin/python setup.py install --prefix=$INSTALL_DIR
                        ]]>
                    </action>

                    <action type="set_environment">
                        <!--
                        Only the PATH environment variable needs to be modified for an Anaconda environment so that it gets
                        the right Python from the environment bin directory.  The way Anaconda environments work is that they
                        hard link everything that is installed into the environment.  For all intents and purposes, this means
                        that each environment is a completely separate installation of Python and all the packages.  By using
                        hard links, this is done efficiently. Thus, there's no need to mess with PYTHONPATH because the Python
                        binary in the environment already searches the site-packages in the environment, and the lib of the
                        environment, and so on.
                        -->
                        <environment_variable action="prepend_to" name="PATH">$INSTALL_DIR/bin</environment_variable>
                        <environment_variable action="prepend_to" name="DYLD_LIBRARY_PATH">$INSTALL_DIR/lib</environment_variable>
                        <environment_variable action="set_to" name="ICQSOL_ROOT_DIR">$INSTALL_DIR</environment_variable>
                    </action>
                </actions>
            </actions_group>
        </install>
        <readme>
<![CDATA[
This installation recipe installs the Anaconda version 2.3.0 of the Python programming language
version 2.7.10.  Anaconda is a completely free Python distribution (including for commercial use
and redistribution). It includes more than 300 of the most popular Python packages for science,
math, engineering, and data analysis.  This list of packages is available at
http://docs.continuum.io/anaconda/pkg-docs.

1) VTK version 6.3.0

The Visualization Toolkit (VTK) is an open-source, freely available software system for 3D
computer graphics, modeling, image processing, volume rendering, scientific visualization, and
information visualization. VTK also includes ancillary support for 3D interaction widgets, two-
and three-dimensional annotation, and parallel computing.  At its core, VTK is implemented as a
C++ toolkit, requiring users to build applications by combining various objects into an application.
The system also supports automated wrapping of the C++ core into Python, Java, and Tcl, so VTK
applications may also be written using these interpreted programming languages.

VTK employs Kitware’s Quality Software Process (CMake, CTest, CDash, and CPack) to build, test,
and package the system, making VTK a cross-platform application dependent on test-driven development
and extreme programming, and enabling the application to produce high-quality, robust code. VTK is
used world-wide in commercial applications, as well as in research and development. It is the basis
for many advanced visualization applications such as ParaView, VisIt, VisTrails, Slicer, MayaVi, and
OsiriX.

3) Pycsg version 0.3.0

Constructive Solid Geometry (CSG) is a modeling technique that uses Boolean operations like union and
intersection to combine 3D solids. This library implements CSG operations on meshes elegantly and
concisely using BSP trees, and is meant to serve as an easily understandable implementation of the
algorithm. All edge cases involving overlapping coplanar polygons in both solids are correctly handled.

4) Pytriangle version 1.0

Pytriangle is a python interface to the 2D triangulation program originally written by Jonathan Richard Shewchuck

5) Icqsol version 1.0

Icqsol is a collection of tools for constructing and solving partial differential equations.
            ]]>

        </readme>
    </package>
</tool_dependency>
