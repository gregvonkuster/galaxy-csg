<?xml version="1.0"?>
<tool_dependency>

    <package name="icqsol" version="latest">
        <install version="1.0">
            <actions_group>
                <actions os="linux" architecture="x86_64">
                    <!-- Install and compile Anaconda 2.3.0 which provides Python 2.7.10 -->
                    <action type="download_file" target_filename="Anaconda-2.3.0-Linux-x86_64.sh">https://3230d63b5fc54e62148e-c95ac804525aac4b6dba79b00b39d1d3.ssl.cf1.rackcdn.com/Anaconda-2.3.0-Linux-x86_64.sh</action>
                    <action type="shell_command">bash Anaconda-2.3.0-Linux-x86_64.sh -b -f -p $INSTALL_DIR</action>

                    <!-- Install VTK 6.3.0 into the above Python -->
                    <action type="shell_command">
                        <![CDATA[
                            export PATH=$INSTALL_DIR/bin:$PATH &&
                            export PYTHONPATH=$INSTALL_DIR/lib/python2.7/site-packages:$INSTALL_DIR/lib/python2.7:$INSTALL_DIR/lib:$INSTALL_DIR:$PYTHONPATH &&
                            export LD_LIBRARY_PATH=$INSTALL_DIR/lib:$LD_LIBRARY_PATH &&
                            export PKG_CONFIG_PATH=$INSTALL_DIR/lib/pkgconfig:$PKG_CONFIG_PATH &&
                            conda install -c https://conda.anaconda.org/anaconda vtk --yes
                        ]]>
                    </action>

                    <!-- Install and compile pycsg version 0.3.0 as a package in the above Python -->
                    <action type="make_directory">$TMP_WORK_DIR/pycsg</action>
                    <action type="change_directory">$TMP_WORK_DIR/pycsg</action>
                    <action type="shell_command">git clone https://github.com/pletzer/pycsg.git</action>
                    <action type="change_directory">pycsg</action>
                    <action type="shell_command">
                        <![CDATA[
                            export PATH=$INSTALL_DIR/bin:$PATH &&
                            export PYTHONPATH=$INSTALL_DIR/lib/python2.7/site-packages:$INSTALL_DIR/lib/python2.7:$INSTALL_DIR/lib:$INSTALL_DIR:$PYTHONPATH &&
                            export LD_LIBRARY_PATH=$INSTALL_DIR/lib:$LD_LIBRARY_PATH &&
                            export PKG_CONFIG_PATH=$INSTALL_DIR/lib/pkgconfig:$PKG_CONFIG_PATH &&
                            $INSTALL_DIR/bin/python setup.py install --prefix=$INSTALL_DIR
                        ]]>
                    </action>

                    <!-- Install and compile pytriangle version 1.0 as a package in the above Python -->
                    <action type="make_directory">$TMP_WORK_DIR/pytriangle</action>
                    <action type="change_directory">$TMP_WORK_DIR/pytriangle</action>
                    <action type="shell_command">git clone https://github.com/pletzer/pytriangle.git</action>
                    <action type="change_directory">pytriangle</action>
                    <action type="shell_command">
                        <![CDATA[
                            export PATH=$INSTALL_DIR/bin:$PATH &&
                            export PYTHONPATH=$INSTALL_DIR/lib/python2.7/site-packages:$INSTALL_DIR/lib/python2.7:$INSTALL_DIR/lib:$INSTALL_DIR:$PYTHONPATH &&
                            export LD_LIBRARY_PATH=$INSTALL_DIR/lib:$LD_LIBRARY_PATH &&
                            export PKG_CONFIG_PATH=$INSTALL_DIR/lib/pkgconfig:$PKG_CONFIG_PATH &&
                            $INSTALL_DIR/bin/python setup.py install --prefix=$INSTALL_DIR
                        ]]>
                    </action>
    
                    <!-- Install and compile icqsol version latest as a package in the above Python -->
                    <action type="make_directory">$TMP_WORK_DIR/icqsol</action>
                    <action type="change_directory">$TMP_WORK_DIR/icqsol</action>
                    <action type="shell_command">git clone https://github.com/pletzer/icqsol.git</action>
                    <action type="change_directory">icqsol</action>
                    <action type="shell_command">
                        <![CDATA[
                            export PATH=$INSTALL_DIR/bin:$PATH &&
                            export PYTHONPATH=$INSTALL_DIR/lib/python2.7/site-packages:$INSTALL_DIR/lib/python2.7:$INSTALL_DIR/lib:$INSTALL_DIR:$PYTHONPATH &&
                            export LD_LIBRARY_PATH=$INSTALL_DIR/lib:$LD_LIBRARY_PATH &&
                            cmake -DINSTALL_USER=OFF -DINSTALL_PREFIX=ON -DCMAKE_INSTALL_PREFIX=$INSTALL_DIR
                        ]]>
                    </action>

                    <action type="set_environment">
                        <environment_variable action="prepend_to" name="PATH">$INSTALL_DIR/bin</environment_variable>
                        <environment_variable action="prepend_to" name="PYTHONPATH">$INSTALL_DIR/lib/python2.7/site-packages:$INSTALL_DIR/lib/python2.7:$INSTALL_DIR/lib:$INSTALL_DIR/bin</environment_variable>
                        <environment_variable action="set_to" name="ANACONDAPYTHONHOME">$INSTALL_DIR</environment_variable>
                        <environment_variable action="prepend_to" name="LD_LIBRARY_PATH">$INSTALL_DIR/lib</environment_variable>
                        <environment_variable action="prepend_to" name="PKG_CONFIG_PATH">$INSTALL_DIR/lib/pkgconfig</environment_variable>
                        <environment_variable action="set_to" name="ICQSOL_ROOT_DIR">$INSTALL_DIR</environment_variable>
                    </action>
                </actions>

                <actions os="darwin" architecture="x86_64">
                    <!-- Install and compile Anaconda 2.3.0 which provides Python 2.7.10 -->
                    <action type="download_file" target_filename="Anaconda-2.3.0-MacOSX-x86_64.sh">https://3230d63b5fc54e62148e-c95ac804525aac4b6dba79b00b39d1d3.ssl.cf1.rackcdn.com/Anaconda-2.3.0-MacOSX-x86_64.sh</action>
                    <action type="shell_command">bash Anaconda-2.3.0-MacOSX-x86_64.sh -b -f -p $INSTALL_DIR</action>

                    <!-- Install VTK 6.3.0 into the above Python -->
                    <action type="shell_command">
                        <![CDATA[
                            export PATH=$INSTALL_DIR/bin:$PATH &&
                            export PYTHONPATH=$INSTALL_DIR/lib/python2.7/site-packages:$INSTALL_DIR/lib/python2.7:$INSTALL_DIR/lib:$INSTALL_DIR:$PYTHONPATH &&
                            export DYLD_LIBRARY_PATH=$INSTALL_DIR/lib:$DYLD_LIBRARY_PATH &&
                            export PKG_CONFIG_PATH=$INSTALL_DIR/lib/pkgconfig:$PKG_CONFIG_PATH &&
                            conda install -c https://conda.anaconda.org/anaconda vtk --yes
                        ]]>
                    </action>
                    <action type="shell_command">
                        ln -s $INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/bin/vtkpython $INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/bin/python
                    </action>

                    <!-- Install and compile pycsg version 0.3.0 as a package in the above Python -->
                    <action type="make_directory">$TMP_WORK_DIR/pycsg</action>
                    <action type="change_directory">$TMP_WORK_DIR/pycsg</action>
                    <action type="shell_command">git clone https://github.com/pletzer/pycsg.git</action>
                    <action type="change_directory">pycsg</action>
                    <action type="shell_command">
                        <![CDATA[
                            export PATH=$INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/bin:$PATH &&
                            export PYTHONPATH=$INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/lib/python2.7/site-packages:$INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/lib/python2.7:pkgs/vtk-6.3.0-py27_0/lib:$INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/bin &&
                            export DYLD_LIBRARY_PATH=$INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/lib:$DYLD_LIBRARY_PATH &&
                            export PKG_CONFIG_PATH=$INSTALL_DIR/lib/pkgconfig:$PKG_CONFIG_PATH &&
                            $INSTALL_DIR/bin/python setup.py install --prefix=$INSTALL_DIR
                        ]]>
                    </action>

                    <!-- Install and compile pytriangle version 1.0 as a package in the above Python -->
                    <action type="make_directory">$TMP_WORK_DIR/pytriangle</action>
                    <action type="change_directory">$TMP_WORK_DIR/pytriangle</action>
                    <action type="shell_command">git clone https://github.com/pletzer/pytriangle.git</action>
                    <action type="change_directory">pytriangle</action>
                    <action type="shell_command">
                        <![CDATA[
                            export PATH=$INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/bin:$PATH &&
                            export PYTHONPATH=$INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/lib/python2.7/site-packages:$INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/lib/python2.7:pkgs/vtk-6.3.0-py27_0/lib:$INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/bin &&
                            export DYLD_LIBRARY_PATH=$INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/lib:$DYLD_LIBRARY_PATH &&
                            export PKG_CONFIG_PATH=$INSTALL_DIR/lib/pkgconfig:$PKG_CONFIG_PATH
                            $INSTALL_DIR/bin/python setup.py install --prefix=$INSTALL_DIR
                        ]]>
                    </action>
    
                    <!-- Install and compile icqsol version latest as a package in the above Python -->
                    <action type="make_directory">$TMP_WORK_DIR/icqsol</action>
                    <action type="change_directory">$TMP_WORK_DIR/icqsol</action>
                    <action type="shell_command">git clone https://github.com/pletzer/icqsol.git</action>
                    <action type="change_directory">icqsol</action>
                    <action type="shell_command">
                        <![CDATA[
                            export PATH=$INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/bin:$PATH &&
                            export PYTHONPATH=$INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/lib/python2.7/site-packages:$INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/lib/python2.7:pkgs/vtk-6.3.0-py27_0/lib:$INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/bin &&
                            export DYLD_LIBRARY_PATH=$INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/lib:$DYLD_LIBRARY_PATH &&
                            cmake -DINSTALL_USER=OFF -DINSTALL_PREFIX=ON -DCMAKE_INSTALL_PREFIX=$INSTALL_DIR
                        ]]>
                    </action>

                    <action type="set_environment">
                        <environment_variable action="prepend_to" name="PATH">$INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/bin</environment_variable>
                        <environment_variable action="prepend_to" name="PYTHONPATH">$INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/lib/python2.7/site-packages:$INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/lib/python2.7:$INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/lib:$INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/bin</environment_variable>
                        <environment_variable action="set_to" name="ANACONDAPYTHONHOME">$INSTALL_DIR</environment_variable>
                        <environment_variable action="prepend_to" name="DYLD_LIBRARY_PATH">$INSTALL_DIR/pkgs/vtk-6.3.0-py27_0/lib</environment_variable>
                        <environment_variable action="prepend_to" name="PKG_CONFIG_PATH">$INSTALL_DIR/lib/pkgconfig</environment_variable>
                        <environment_variable action="set_to" name="ICQSOL_ROOT_DIR">$INSTALL_DIR</environment_variable>
                    </action>
                </actions>
            </actions_group>
        </install>
        <readme>
<![CDATA[
This installation recipe compiles and installs Anaconda version 3.2.0 which provides
Python version 2.7.10 along with the following Python packages which are in addition
to the 300+ packages that come with Anaconda.

1) VTK version 6.3.0

The Visualization Toolkit (VTK) is an open-source, freely available software system for 3D
computer graphics, modeling, image processing, volume rendering, scientific visualization, and
information visualization. VTK also includes ancillary support for 3D interaction widgets, two-
and three-dimensional annotation, and parallel computing.  At its core, VTK is implemented as a
C++ toolkit, requiring users to build applications by combining various objects into an application.
The system also supports automated wrapping of the C++ core into Python, Java, and Tcl, so VTK
applications may also be written using these interpreted programming languages.

VTK employs Kitware’s Quality Software Process (CMake, CTest, CDash, and CPack) to build, test,
and package the system, making VTK a cross-platform application dependent on test-driven development
and extreme programming, and enabling the application to produce high-quality, robust code. VTK is
used world-wide in commercial applications, as well as in research and development. It is the basis
for many advanced visualization applications such as ParaView, VisIt, VisTrails, Slicer, MayaVi, and
OsiriX.

3) Pycsg version 0.3.0

Constructive Solid Geometry (CSG) is a modeling technique that uses Boolean operations like union and
intersection to combine 3D solids. This library implements CSG operations on meshes elegantly and
concisely using BSP trees, and is meant to serve as an easily understandable implementation of the
algorithm. All edge cases involving overlapping coplanar polygons in both solids are correctly handled.

4) Pytriangle version 1.0

Pytriangle is a python interface to the 2D triangulation program originally written by Jonathan Richard Shewchuck

5) Icqsol version latest

Icqsol is a collection of tools for constructing and solving partial differential equations.
            ]]>

        </readme>
    </package>
</tool_dependency>
